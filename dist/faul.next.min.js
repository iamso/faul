/*!
 * faul - version 0.1.0
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2017 Steve Ottoz
 */
export default class Faul{constructor({items:a='.faul',bg:b=!1,threshold:c=0,stagger:d=100,fn:f=g=>{}}={}){this.hires=1<window.devicePixelRatio,this.attr=this.hires?'srcHires':'src',this.bg=b,this.th=c,this.stagger=d,this.fn=f,this.set(a),this.init()}init(){this.handler=this.load.bind(this),this.load(),window.addEventListener('scroll',this.handler),window.addEventListener('resize',this.handler)}set(a){this.items=[].slice.call(a instanceof NodeList?a:document.querySelectorAll(a),0)}load(a){this.items=this.items.filter((b,c,d)=>{const f=window.pageYOffset,g=f+window.innerHeight,h=Math.round(b.getBoundingClientRect().top+f),j=Math.round(h+b.clientHeight),k=j>f-this.th&&h<g+this.th;if(k){let l=b.dataset[this.attr];if(l=l||b.dataset.src,l)if(b.style.transitionDelay=`${c*this.stagger}ms`,this.bg){const m=new Image;m.onload=n=>{b.style.backgroundImage=`url(${l})`,b.classList.add('loaded'),this.fn(b)},m.src=l}else b.onload=m=>{b.classList.add('loaded'),this.fn(b)},b.src=l}return!k})}destroy(){window.removeEventListener('scroll',this.handler),window.removeEventListener('resize',this.handler)}}