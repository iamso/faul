/*!
 * faul - version 0.1.1
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2017 Steve Ottoz
 */
export default class Faul{constructor({items:a='.faul',bg:b=!1,threshold:c=0,stagger:d=100,fn:f=g=>{}}={}){this.hires=1<window.devicePixelRatio,this.attr=this.hires?'srcHires':'src',this.bg=b,this.th=c,this.stagger=d,this.fn=f,this.set(a),this.init()}init(){this.handler=this.load.bind(this),this.load(),window.addEventListener('scroll',this.handler),window.addEventListener('resize',this.handler)}set(a){this.items=[].slice.call(a instanceof NodeList?a:document.querySelectorAll(a),0)}load(a){let b=0;this.items=this.items.filter((c,d,f)=>{const g=window.pageYOffset,h=g+window.innerHeight,j=Math.round(c.getBoundingClientRect().top+g),k=Math.round(j+c.clientHeight),l=k>g-this.th&&j<h+this.th;if(l){let m=c.dataset[this.attr];if(m=m||c.dataset.src,m){if(c.style.transitionDelay=`${b*this.stagger}ms`,this.bg){const n=new Image;n.onload=o=>{c.style.backgroundImage=`url(${m})`,c.classList.add('loaded'),this.fn(c)},n.src=m}else c.onload=n=>{c.classList.add('loaded'),this.fn(c)},c.src=m;b++}}return!l})}destroy(){window.removeEventListener('scroll',this.handler),window.removeEventListener('resize',this.handler)}}